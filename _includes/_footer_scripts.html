{% if page.mediaplayer == true %}
<script>
$('audio,video').mediaelementplayer();
</script>
{% endif %}


<script src="{{ site.url }}{{ site.baseurl }}/assets/js/javascript.min.js"></script>

{% comment %}
Ensure Magellan navigation is initialized - Foundation should auto-init, but we ensure it's ready
{% endcomment %}
<script>
$(document).ready(function() {
  // Foundation should have auto-initialized, but ensure magellan-expedition is working
  if ($('[data-magellan-expedition]').length > 0) {
    // Wait for Foundation to be ready, then ensure magellan is initialized
    setTimeout(function() {
      // Check if magellan-expedition is initialized
      var expedition = $('[data-magellan-expedition]');
      expedition.each(function() {
        var $exp = $(this);
        // If not initialized, initialize it
        if (!$exp.data('magellan-expedition-init')) {
          // Try to initialize via Foundation
          try {
            $(document).foundation('magellan-expedition', 'init', $exp);
          } catch(e) {
            // If that fails, Foundation should have auto-initialized
            console.log('Magellan initialization check:', e);
          }
        }
      });
      // Force reflow and trigger events
      $(document).foundation('magellan-expedition', 'reflow');
      $(window).trigger('scroll.fndtn.magellan');
      $(window).trigger('resize.fndtn.magellan');
    }, 300);
  }
});
</script>


{% assign banner_image = page.header.image_fullwidth | default: site.background_banner %}
{% if banner_image %}
<script>
$(document).ready(function() {
    // Configure backstretch to stretch horizontally and fill the container
    // Use site.url + baseurl for images directory to work in both local and production
    {% assign banner_url = site.url | append: site.baseurl | append: '/images/' | append: banner_image %}
    var bannerImageUrl = "{{ banner_url }}";
    
    var backstretchOptions = {
        transition: 'fade', 
        transitionDuration: 2000,
        alignX: 0.5,
        alignY: 0.5,
        centeredX: false, // Disable centering to allow horizontal stretch
        centeredY: false  // Disable centering to allow vertical stretch
    };
    
    $("#masthead").backstretch(bannerImageUrl, backstretchOptions);
    $("#masthead-with-text").backstretch(bannerImageUrl, backstretchOptions);
    
    // Force the backstretch image to stretch horizontally to full width with fixed height
    function stretchBackstretchImage() {
        $("#masthead .backstretch img, #masthead-with-text .backstretch img").each(function() {
            var $img = $(this);
            // Use attr to set style with !important
            var imgStyle = 'width: 100% !important; height: 400px !important; min-width: 100% !important; max-width: none !important; object-fit: cover !important; object-position: center center !important; left: 0 !important; top: 0 !important;';
            $img.attr('style', imgStyle + ($img.attr('style') || ''));
            
            // Also ensure the backstretch container is properly sized
            var $container = $img.closest('.backstretch');
            var containerStyle = 'width: 100% !important; height: 400px !important; left: 0 !important; top: 0 !important;';
            $container.attr('style', containerStyle + ($container.attr('style') || ''));
        });
    }
    
    // Run on load and also set up a mutation observer to catch dynamically added images
    $("#masthead .backstretch img, #masthead-with-text .backstretch img").on('load', stretchBackstretchImage);
    
    // Also run after a short delay to catch images that load quickly
    setTimeout(stretchBackstretchImage, 100);
    setTimeout(stretchBackstretchImage, 500);
});
</script>
{% endif %}



{% if site.google_analytics_tracking_id %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.google_analytics_tracking_id }}', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');

</script>
{% endif %}



{% comment %}
#  Start of Tawk.to Script
#
#  More information in _config.yml
#
{% endcomment %}
{% if site.tawkto_embed_uri and page.tawkto == true %}
<script type="text/javascript">
var $_Tawk_API={},$_Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='{{ site.tawkto_embed_uri }}';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
{% endif %}
