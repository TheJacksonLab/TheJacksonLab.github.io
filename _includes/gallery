{% comment %}
*
*   This include lets you easily embed a gallery into your post.
*   To use the gallery include you...
*
*   1. ...need only the full-size image (thumbnails are auto-cropped)
*   2. Place images in /assets/img/gallery/ directory
*   3. Define images in frontmatter:
*
*   gallery:
*       - image_url: gallery-image.jpg
*
*   4. Give your image a caption â€“ works without captions, too.
*
*   gallery:
*       - image_url: gallery-image.jpg
*          caption: Full caption for lightbox
*          hover_caption: Short caption for hover
*
*   5. Add the include whereever you want in your content like this:
*
*   {% include gallery %}
*
*   Images should be placed in /assets/img/gallery/ directory
*   Thumbnails are automatically cropped from full-size images using CSS
*   Hover captions appear when hovering over thumbnails
*   If hover_caption is not provided, the regular caption will be used for hover
*
{% endcomment %}
<style>
.gallery-thumbnail {
    width: 100%;
    height: 200px;
    object-fit: cover;
    object-position: center;
    display: block;
}
.gallery-item {
    position: relative;
    overflow: hidden;
}
.gallery-item:hover .gallery-hover-caption {
    opacity: 1;
}
.gallery-hover-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.75);
    color: white;
    padding: 8px 12px;
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    text-align: center;
}
</style>
<div>
	<ul class="clearing-thumbs small-block-grid-4" data-clearing>
		{% for item in page.gallery %}
		{% assign hover_text = item.hover_caption | default: item.caption %}
		<li class="gallery-item">
			<a href="{{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ item.image_url }}">
				<img class="gallery-thumbnail" {% if item.caption %}data-caption="{{ item.caption }}"{% endif %} {% if hover_text %}title="{{ hover_text }}"{% endif %} src="{{ site.url }}{{ site.baseurl }}/assets/img/gallery/{{ item.image_url }}" alt="{% if item.caption %}{{ item.caption }}{% endif %}">
				{% if hover_text %}
				<div class="gallery-hover-caption">{{ hover_text }}</div>
				{% endif %}
			</a>
		</li>
		{% endfor %}
	</ul>
</div>
<script>
// Close gallery lightbox when clicking outside the image
(function($) {
  $(document).ready(function() {
    // Listen for when the clearing blackout is opened, then add click handler
    $(document).on('opened.fndtn.clearing', function() {
      var $blackout = $('.clearing-blackout');
      
      // Only bind if not already bound (avoid duplicate handlers)
      if ($blackout.data('gallery-close-bound')) {
        return;
      }
      $blackout.data('gallery-close-bound', true);
      
      // Bind click handler directly to this blackout instance
      $blackout.on('click.gallery-bg', function(e) {
        var $target = $(e.target);
        var $container = $blackout.find('.clearing-container');
        
        // If click is on close button, navigation, or container - let Foundation handle it
        if ($target.is('.clearing-close') || $target.closest('.clearing-close').length ||
            $target.is('.clearing-main-prev, .clearing-main-next') || 
            $target.closest('.clearing-main-prev, .clearing-main-next').length ||
            ($container.length && ($container.is($target) || $container.has($target).length > 0))) {
          return; // Let event bubble to Foundation
        }
        
        // Click is on blackout background - close it
        e.preventDefault();
        e.stopPropagation();
        
        var body = $(document.body);
        var visible_image = $blackout.find('.visible-img');
        
        body.css('overflow', '');
        visible_image.trigger('close.fndtn.clearing');
        
        if (Foundation && Foundation.libs && Foundation.libs.clearing) {
          Foundation.libs.clearing.settings.prev_index = 0;
        }
        
        $blackout.find('ul[data-clearing]').attr('style', '');
        $blackout.removeClass('clearing-blackout');
        $container.removeClass('clearing-container');
        visible_image.hide();
        visible_image.trigger('closed.fndtn.clearing');
        $('body').off('touchmove');
        
        // Unbind our handler when closed
        $blackout.off('click.gallery-bg').removeData('gallery-close-bound');
        
        return false;
      });
    });
  });
})(jQuery);
</script>
